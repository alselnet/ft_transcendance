(()=>{"use strict";var t,e={354:(t,e,n)=>{const o=n.p+"images/4330a4f692ec0ede7355.png",a=`${window.location.protocol}//${window.location.host}/api/auth`,s=`${window.location.protocol}//${window.location.host}`;function i(){window.location.href=`${a}/42login/`}function r(t){for(let e=0,n=1;;e+=n,n/=2)if(t>=(7-4*e)/11)return-Math.pow((11-6*e-11*t)/4,2)+Math.pow(n,2)}function l(t){return function(e){return 1-t(1-e)}}function c({timing:t,draw:e,duration:n}){let o=performance.now();requestAnimationFrame((function a(s){let i=(s-o)/n;i>1&&(i=1);let r=t(i);e(r),i<1&&requestAnimationFrame(a)}))}function d(){if(!document.getElementById("root"))return void console.error("#root not found in the DOM");let t=document.querySelector(".navbar-container");t&&t.remove();let e=document.querySelector(".logout-container");e&&e.remove()}const u=()=>{d();let t=document.querySelector("#section");t&&(t.innerHTML=`\n        <div class="balls-home d-none d-md-flex">\n            <div class="orange-ball-home">\n                <a class="balls-inscription" href="#/signin" data-hash="signin">\n                    Inscription\n                </a>\n            </div>\n            <div class="white-ball-home">\n                <a class="balls-inscription" href="#/login" data-hash="login">\n                    Connexion\n                </a>\n            </div>\n            <div class="btn-container-home">\n                <button id="fortyTwoSignInBtn" class="btn-42-home">\n                    <p class="co-42-home">connexion avec</p>\n                    <img src="${o}" class="img-42-home" alt="button-42">\n                </button>\n            </div>\n        </div>\n\n        <div class="balls-home-sm d-flex d-md-none">\n            <div class="orange-ball-home-sm">\n                <a class="balls-inscription" href="#/signin" data-hash="signin">\n                    Inscription\n                </a>\n            </div>\n            <div class="white-ball-home-sm">\n                <a class="balls-inscription" href="#/login" data-hash="login">\n                    Connexion\n                </a>\n            </div>\n            <div class="btn-container-home">\n                <button id="fortyTwoSignInBtnSm" class="btn-42-home">\n                    <p class="co-42-home">connexion avec</p>\n                    <img src="${o}" class="img-42-home" alt="button-42">\n                </button>\n            </div>\n        </div>\n        `);const e=document.querySelector(".white-ball-home"),n=document.querySelector(".orange-ball-home");e&&n?function(t,e,n){e.style.position="absolute",n.style.position="absolute",e.style.top="0",n.style.top="0";const o=(t.clientHeight-e.clientHeight)/2,a=(t.clientHeight-n.clientHeight)/2;c({duration:2e3,timing:l(r),draw(t){e.style.transform=`translateY(${o*t}px)`}}),setTimeout((()=>{c({duration:2e3,timing:l(r),draw(t){n.style.transform=`translateY(${a*t}px)`}})}),1e3)}(t,e,n):console.error(".white-ball-home or .orange-ball-home not found in the DOM");const a=document.getElementById("fortyTwoSignInBtn"),s=document.getElementById("fortyTwoSignInBtnSm");a?a.addEventListener("click",(()=>{i()})):console.error("#fortyTwoSignInBtn not found in the DOM"),s?s.addEventListener("click",(()=>{i()})):console.error("#fortyTwoSignInBtnSm not found in the DOM")};function m(t){let e=("; "+document.cookie).split("; "+t+"=");if(2===e.length)return e.pop().split(";").shift()}const p=`${window.location.protocol}//${window.location.host}/api/auth`,v=`${window.location.protocol}//${window.location.host}/api/users`;let h=null;function g(){const t=window.innerWidth>=768,e=document.getElementById("login-form"),n=document.getElementById("login-form-sm");t?(n&&n.classList.add("d-none"),e&&(e.classList.remove("d-none"),e.classList.add("d-md-block")),h&&h!==e&&h.removeEventListener("submit",f),e&&(e.addEventListener("submit",f),h=e)):(e&&(e.classList.add("d-none"),e.classList.remove("d-md-block")),n&&(n.classList.remove("d-none"),n.classList.add("d-md-block")),h&&h!==n&&h.removeEventListener("submit",f),n&&(n.addEventListener("submit",f),h=n))}function f(t){t.preventDefault(),console.log("Form submitted");const e={username:document.getElementById("username")?.value||document.getElementById("username-sm")?.value,password:document.getElementById("password")?.value||document.getElementById("password-sm")?.value};console.log("Form data:",e),fetch(`${p}/signin/`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":m("csrftoken")},body:JSON.stringify(e)}).then((t=>t.ok?t.json():t.json().then((t=>{throw new Error("Erreur de connexion")})))).then((t=>(console.log("Réponse du backend:",t),fetch(`${v}/me/`,{method:"GET",headers:{Authorization:`Bearer ${t.access}`,"Content-Type":"application/json"}})))).then((t=>t.json())).then((t=>{console.log("User data:",t),t.tfa_token?localStorage.setItem("tfa",t.tfa_token):console.error("Erreur : `tfa_token` non disponible dans les données utilisateur.");const n=localStorage.getItem("tfa");return console.error("TFA :",n),"email"===t.two_fa_method?fetch(`${p}/generate-2fa-code/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tfa_token:n})}).then((()=>{n?window.location.href=`#/2fa-auth?tfa=${encodeURIComponent(n)}`:alert("Erreur tfa_token non valide")})).catch((t=>{console.error("Erreur lors de l'envoi du code 2FA:",t),alert("Erreur lors de l'envoi du code 2FA. Veuillez réessayer.")})):"authenticator"!==t.two_fa_method?fetch(`${p}/signin/`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":m("csrftoken")},body:JSON.stringify({username:t.username,password:e.password})}).then((t=>t.ok?t.json():t.json().then((t=>{throw new Error("Erreur lors de la récupération des tokens: "+t.message)})))).then((t=>{console.log("Tokens récupérés:",t),localStorage.removeItem("tfa"),localStorage.setItem("accessToken",t.access),localStorage.setItem("refreshToken",t.refresh),window.location.href="#/dashboard"})).catch((t=>{console.error("Erreur:",t),alert("Erreur lors de la récupération des tokens. Veuillez réessayer.")})):void(n?window.location.href=`#/qr-code?tfa=${encodeURIComponent(n)}`:alert("Erreur tfa_token non valide"))})).catch((t=>{console.error("Erreur:",t),alert("Nom d utilisateur ou mot de passe incorrect")}))}const w=`${window.location.protocol}//${window.location.host}/api/auth`;let b=null;function y(){const t=window.innerWidth>=768,e=document.getElementById("signin-form"),n=document.getElementById("signin-form-sm");t?(n&&n.classList.add("d-none"),e&&(e.classList.remove("d-none"),e.classList.add("d-md-block")),b&&b!==e&&b.removeEventListener("submit",E),e&&(e.addEventListener("submit",E),b=e)):(e&&(e.classList.add("d-none"),e.classList.remove("d-md-block")),n&&(n.classList.remove("d-none"),n.classList.add("d-md-block")),b&&b!==n&&b.removeEventListener("submit",E),n&&(n.addEventListener("submit",E),b=n))}function E(t){t.preventDefault(),console.log("Form submitted");const e={username:document.getElementById("username")?.value||document.getElementById("username-sm")?.value,email:document.getElementById("email")?.value||document.getElementById("email-sm")?.value,password:document.getElementById("password")?.value||document.getElementById("password-sm")?.value,confirmPassword:document.getElementById("confirmPassword")?.value||document.getElementById("confirmPassword-sm")?.value};console.log("Form data:",e);const n=/^[a-zA-Z0-9]{1,8}$/.test(e.username);const o=/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.+[a-zA-Z]{2,}$/.test(e.email);const a=/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[^a-zA-Z\d]).{8,}$/.test(e.password);return n?o?a?e.password===e.confirmPassword?void fetch(`${w}/register/`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":m("csrftoken")},body:JSON.stringify(e)}).then((t=>(console.log("Response status:",t.status),t.ok?t.json():t.json().then((t=>{throw new Error(t.message)}))))).then((t=>{console.log("Response data:",t),alert(t.message),localStorage.setItem("accessToken",t.access),localStorage.setItem("refreshToken",t.refresh),console.log("Redirecting to dashboard from signin..."),window.location.href="#/dashboard",console.log("Current hash:",window.location.hash)})).catch((t=>{console.error("Error:",t),alert("User creation failed.")})):(alert("confirmation de mot de passe incorrect"),void console.log("Passwords do not match")):(alert("mot de passe doit contenir au moins 8 caractères, une lettre, un chiffre et un caractère spécial."),void console.log("Invalid password")):(alert("email non conforme"),void console.log("Invalid email")):(alert("Le nom d'utilisateur peut avoir maximum 8 caractères, et ne peut contenir que des lettres et des chiffres"),void console.log("Invalid username"))}var k=n(964);const $=`${window.location.protocol}//${window.location.host}/api/auth`,L=()=>({"Content-Type":"application/json","X-CSRFToken":m("csrftoken"),Authorization:`Bearer ${localStorage.getItem("accessToken")}`}),S=async()=>{const t=localStorage.getItem("accessToken"),e=localStorage.getItem("refreshToken");if(!t)return window.location.hash="#/",!1;if(n=t,!(JSON.parse(atob(n.split(".")[1])).exp<Date.now()/1e3))return!0;var n;if(!e)return window.location.hash="#/",!1;console.log("Refreshing token");const o=await fetch(`${$}/token/refresh/`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":m("csrftoken")},body:JSON.stringify({refresh:e})});if(!o.ok)return console.log("Failed to fetch access token from server"),localStorage.removeItem("accessToken"),localStorage.removeItem("refreshToken"),window.location.hash="#/",!1;const a=await o.json();return localStorage.setItem("accessToken",a.access),!0},T=async(t,e={})=>{if(!await S())throw new Error("User is not authenticated");return e.method="GET",e.headers={...L(),...e.headers},fetch(t,e)},I=async(t,e,n={})=>{if(!await S())throw new Error("User is not authenticated");return n.method="POST",n.headers={...L(),...n.headers},n.body=JSON.stringify(e),fetch(t,n)},_=async(t,e,n={})=>{if(!await S())throw new Error("User is not authenticated");return n.method="PUT",n.headers={...L(),...n.headers},n.body=JSON.stringify(e),fetch(t,n)},x=async(t,e={})=>{if(!await S())throw new Error("User is not authenticated");const n={method:"DELETE",headers:{...L()},body:JSON.stringify(e)};try{return await fetch(t,n)}catch(t){throw console.error("Error with DELETE request:",t),t}},q=`${window.location.protocol}//${window.location.host}/api/users`,B=async()=>{if(!await S())throw new Error("User is not authenticated");let t=document.querySelector("#section");if(t){t.innerHTML='   \n        <div class="game-container" id="game-container">\n            <div class="score-container">\n                <span id="score-player1" class="score-player">Player 1: 0</span>\n                <span id="score-player2" class="score-player">Player 2: 0</span>\n            </div>\n            <canvas id="game-canvas" class="game-canvas"></canvas>\n        <div class="button-container" id="initial-buttons">\n            <button class="game-button" id="local-mode">Local</button>\n            <button class="game-button" id="tournoi-mode">Tournoi</button>\n        </div>\n        <div class="button-container" id="settings">\n            <div>\n                <label for="ball-speed">Ball Speed:</label>\n                <select id="ball-speed">\n                <option value="20" class="value">Normal</option>\n                    <option value="15" class="value">Slow</option>\n                    <option value="25" class="value">Fast</option>\n                </select>\n            </div>\n            <div>\n                <label for="paddle-speed">Paddle Speed:</label>\n                <select id="paddle-speed">\n                <option value="7" class="value">Normal</option>\n                    <option value="5" class="value">Slow</option>\n                    <option value="10" class="value">Fast</option>\n                </select>\n            </div>\n            <div>\n                <label for="paddle-color">Paddle color:</label>\n                <select id="paddle-color">\n                    <option value="white" class="value">White</option>\n                    <option value="orange" class="value">Orange</option>\n                    <option value="black" class="value">Black</option>\n                </select>\n            </div>\n            <div>\n                <label for="ball-color">Ball color:</label>\n                <select id="ball-color">\n                    <option value="white" class="value">White</option>\n                    <option value="orange" class="value">Orange</option>\n                    <option value="black" class="value">Black</option>\n                </select>\n            </div>\n            <div>\n                <label for="ball-size">Ball size:</label>\n                <select id="ball-size">\n                    <option value="8" class="value">normal</option>\n                    <option value="4" class="value">small</option>\n                    <option value="15" class="value">big</option>\n                </select>\n            </div>\n            <button class="game-button" id="start-game-btn">Start Game</button>\n        </div>\n        <div class="button-container" id="tournoi-buttons">\n            <button class="game-button" id="three-players-btn">3 Players</button>\n            <button class="game-button" id="four-players-btn">4 Players</button>\n            <button class="game-button" id="five-players-btn">5 Players</button>\n        </div>\n    </div>\n    ';const e=document.getElementById("initial-buttons"),n=document.getElementById("tournoi-buttons"),o=document.getElementById("local-mode"),a=document.getElementById("tournoi-mode"),s=document.getElementById("settings"),i=document.getElementById("start-game-btn"),r=document.getElementById("ball-speed"),l=document.getElementById("paddle-speed"),c=document.getElementById("game-canvas"),d=localStorage.getItem("backgroundClass"),u=document.getElementById("ball-color"),m=document.getElementById("paddle-color"),p=document.getElementById("ball-size");if(!c)return void console.error("Failed to find the canvas element with ID game-canvas");let v,h,g,f,w,b,y,E,$,L,_,x,F,A,M,j,C,O,P,N,z,D,R=!1;async function H(){v=0,h=0,g=0,f=0,w=null,b={},y=[],j=0,C=0,N="black",P="white",z=8;try{const t=await T(`${q}/me/`);if(!t.ok)throw new Error("Network response was not ok");const e=await t.json();console.log(e),O=e.username}catch(t){console.error("Fetch error:",t),O="Unknown Player"}nt(j,C)}function U(){e.classList.add("hidden"),n.classList.add("hidden"),s.classList.add("hidden")}function J(){nt(0,0),U(),s.classList.remove("hidden")}function W(){const t=[];return[{color:33224,position:[-80,150,-200]},{color:0,position:[0,150,-200]},{color:15610702,position:[80,150,-200]},{color:16040704,position:[-40,100,-200]},{color:40765,position:[40,100,-200]}].forEach((e=>{const n=new k.O3Y(50,8,16,16),o=new k.tXL({color:e.color,transparent:!0,opacity:.8}),a=new k.eaF(n,o);a.position.set(...e.position),$.add(a),t.push(a)})),t}function V(){$=new k.Z58,L=new k.ubm(75,window.innerWidth/window.innerHeight,.1,1e3),L.position.set(0,0,100),E=new k.JeP({canvas:c,antialias:!1}),E.setSize(window.innerWidth,window.innerHeight),"bg-roland"==d?E.setClearColor(10834712):"bg-wimbledon"==d?E.setClearColor(2846245):E.setClearColor(4690117);const t=new k.$p8(16777215,.2);$.add(t);const e=new k.ZyN(16777215,1);e.position.set(0,500,200),$.add(e),A=1200,M=700;const n=new k.tXL({color:P});_=new k.eaF(new k.iNn(10,10,70),n),x=new k.eaF(new k.iNn(10,10,70),n),_.position.set(-A/2+10,5,0),x.position.set(A/2-10,5,0),$.add(_),$.add(x);const o=z,a=new k.tXL({color:N});F=new k.eaF(new k.Gu$(o,32,32),a),F.position.set(0,o,0),$.add(F);const s=A,i=new k.tXL({color:16777215}),r=new k.eaF(new k.iNn(s,15,10),i),l=new k.eaF(new k.iNn(s,15,10),i);r.position.set(0,7.5,M/2+5),l.position.set(0,7.5,-M/2-5),$.add(r),$.add(l);const u=new k.tXL({color:16777215}),m=new k.iNn(10,1,10),p=[];for(let t=-M/2+20;t<M/2;t+=40){const e=new k.eaF(m,u);e.position.set(0,1,t),p.push(e),$.add(e)}D=W(),L.position.set(0,600,500),L.lookAt(new k.Pq0(0,0,0)),E.render($,L)}function Z(t){console.log("inside prompt player name"),y=[];for(let e=1;e<=t;e++){let t,n=!1;for(;!n;){if(t=prompt(`Player ${e} name (max 10 characters):`),null===t)return console.log("Player input cancelled. Tournament not started."),void J();""===t.trim()?alert("Please enter a valid name."):t.length>10?alert("Name too long! Please enter a name with a maximum of 10 characters."):y.includes(t.trim())?alert("Name already taken! Please enter a unique name."):(n=!0,y.push(t.trim()))}}for(let t=0;t<y.length;t++)console.log("player name:",y[t]);X(y)}async function X(t){let e=1;for(;t.length>1;){console.log(`Round ${e}:`);let n=[];if(t.length%2!=0){let e=t.pop();n.push(e),console.log(`${e} advances to the next round automatically`)}for(let o=0;o<t.length;o+=2){let a=t[o],s=t[o+1];const i=`local_match_${a}_vs_${s}`.replace(/[^a-zA-Z0-9_]/g,"");U(),alert(`Round: ${e}  Match: ${a} Vs ${s}`),await Y(i,a,s,n,r.value,l.value)}t=n,e++}alert(`Tournament Winner: ${t[0]}`),location.reload()}function G(t,e,n){w&&w.close(),R=!1,w=new WebSocket(`wss://${window.location.host}/ws/pong/${t}/`),w.onopen=function(t){console.log("Connected to the server"),w.send(JSON.stringify({type:"config",ball_speed:e,paddle_speed:n,ball_size:z})),w.send(JSON.stringify({type:"start_ball"}))},w.onmessage=async function(t){const e=JSON.parse(t.data);if("game_state"===e.type)et(e);else if("start_game"===e.type)console.log("The game has started!");else if("game_over"===e.type){R=!0,console.log("Fin de game");let t={winner_username:"",loser_username:"",winner_score:0,loser_score:0,perfect:!1,local_game:!0};console.log(e),1==e.winner?(t.winner_username=O,t.loser_username="Player2",t.winner_score=e.score_player1,t.loser_score=e.score_player2,0==e.score_player2&&(t.perfect=!0)):(t.winner_username="Player2",t.loser_username=O,t.winner_score=e.score_player2,t.loser_score=e.score_player1,0==e.score_player1&&(t.perfect=!0)),console.log(t);try{const e=await I(`${q}/game-history/`,t),n=await e.json();e.ok?console.log("Game history updated successfully:",n):console.error("Error updating game history:",n)}catch(t){console.error("Fetch error:",t)}Q(500),location.reload()}},w.onclose=function(t){rt(),console.log("Disconnected from the server"),1==j?alert("Player 1 wins!"):alert("Player 2 wins!"),location.reload()},w.onerror=function(t){console.error(`WebSocket error: ${t.message}`)},document.addEventListener("keydown",(function(t){b[t.code]=!0,K()})),document.addEventListener("keyup",(function(t){b[t.code]=!1}))}function Q(t=500){w&&setTimeout((()=>{w.close(),w=null}),t)}function Y(t,e,n,o,a,s){return w&&w.close(),R=!1,new Promise(((i,r)=>{w=new WebSocket(`wss://${window.location.host}/ws/pong/${t}/`),w.onopen=function(t){console.log("Connected to the server"),w.send(JSON.stringify({type:"config",ball_speed:a,paddle_speed:s,ball_size:z}))},w.onmessage=function(t){const a=JSON.parse(t.data);if("game_state"===a.type)tt(a,e,n);else if("start_game"===a.type)console.log("The game has started!");else if("game_over"===a.type){let t;console.log("Fin de game"),R=!0,t=1==a.winner?e:n,alert(`${e} vs ${n} - Winner: ${t}`),o.push(t)}},w.onclose=function(t){rt(),w.close(),w=null,U(),i(),console.log("Disconnected from the server")},w.onerror=function(t){console.error(`WebSocket error: ${t.message}`),r(t)},document.addEventListener("keydown",(function(t){b[t.code]=!0,K()})),document.addEventListener("keyup",(function(t){b[t.code]=!1,rt()}))}))}function K(){w&&w.readyState===WebSocket.OPEN&&!1===R&&(b.ArrowUp&&w.send(JSON.stringify({type:"move",player:2,direction:"up"})),b.ArrowDown&&w.send(JSON.stringify({type:"move",player:2,direction:"down"})),b.KeyW&&w.send(JSON.stringify({type:"move",player:1,direction:"up"})),b.KeyS&&w.send(JSON.stringify({type:"move",player:1,direction:"down"})),b.Space&&w.send(JSON.stringify({type:"start_ball"})))}function tt(t,e,n){v=t.player1_y_position,h=t.player2_y_position,g=t.ball_x_position,f=t.ball_y_position,j=t.score_player1,C=t.score_player2,ot(j,C,e,n),at(e,n)}function et(t){v=t.player1_y_position,h=t.player2_y_position,g=t.ball_x_position,f=t.ball_y_position,j=t.score_player1,C=t.score_player2,nt(j,C),st()}function nt(t,e){document.getElementById("score-player1").textContent=`${O}: ${t}`,document.getElementById("score-player2").textContent=`Invité: ${e}`}function ot(t,e,n,o){document.getElementById("score-player1").textContent=`${n}: ${t}`,document.getElementById("score-player2").textContent=`${o}: ${e}`}function at(t,e){E.render($,L),_.position.z=v,x.position.z=h,F.position.x=g,F.position.z=f,E.render($,L)}function st(){E.render($,L),_.position.z=v,x.position.z=h,F.position.x=g,F.position.z=f,E.render($,L)}function it(){K(),requestAnimationFrame(it)}function rt(){b={}}function lt(){v=0,h=0,g=0,f=0,j=0,C=0,R=!1,nt(j,C)}H(),J(),i.addEventListener("click",(function(){U(),N=u.value,P=m.value,z=p.value,console.log(N,P,z),e.classList.remove("hidden"),V()})),o.addEventListener("click",(function(){console.log("inside local"),U();const t="local_"+(new Date).getTime();console.log(t),G(t,r.value,l.value)})),document.getElementById("three-players-btn").addEventListener("click",(()=>Z(3))),document.getElementById("four-players-btn").addEventListener("click",(()=>Z(4))),document.getElementById("five-players-btn").addEventListener("click",(()=>Z(5))),a.addEventListener("click",(function(){console.log("inside tournoi"),U(),n.classList.remove("hidden")})),it(),window.addEventListener("popstate",(function(){console.log("fermeture de la socket"),w&&(w.close(),w=null,lt())})),window.addEventListener("hashchange",(function(){"#/game"===location.hash?B():w&&(w.close(),w=null,lt())})),window.addEventListener("resize",(()=>{const t=window.innerWidth,e=window.innerHeight;c.width=t,c.height=e,E.setSize(t,e),L.aspect=t/e,L.updateProjectionMatrix(),E.render($,L)})),window.addEventListener("unload",(()=>{document.removeEventListener("keydown",K),document.removeEventListener("keyup",K)}))}},F=`${window.location.protocol}//${window.location.host}/api/users`;function A(t){switch(t){case"online":return"green";case"offline":return"grey";case"in game":return"orange";default:return"red"}}const M=`${window.location.protocol}//${window.location.host}/api/users`,j=`${window.location.protocol}//${window.location.host}/api/auth`,C=t=>{console.log("Update 2FA Method"),I(`${j}/update-2fa/`,{method:t}).then((t=>t.ok?t.json().then((t=>{alert("2FA method updated successfully"),window.location.reload()})):t.json().then((t=>{alert(`Error: ${t.error||"Failed to update 2FA method"}`)})))).catch((t=>{console.error("Error updating 2FA method:",t),alert("An error occurred while updating the 2FA method")}))},O=t=>{console.log("Change Background Image"),document.body.classList.remove("bg-nagoya","bg-roland","bg-wimbledon"),document.body.classList.add(t),localStorage.setItem("backgroundClass",t)},P=()=>{const t=localStorage.getItem("backgroundClass");t&&O(t)},N=()=>{P(),document.querySelectorAll(".dropdown-menu .dropdown-item").forEach((t=>{t.addEventListener("click",(e=>{e.preventDefault();const n=t.getAttribute("data-bg-class");n&&O(n)}))}))},z=(t,e)=>{const n=t.value;n&&(D(n,e)?alert("Vous ne pouvez pas accéder à votre propre profil."):window.location.href=`#/friendprofile/${n}`,t.value="")},D=(t,e)=>t===e,R=()=>{section.querySelector("#edit-username").addEventListener("click",(t=>{window.location.hash="#/update-username"})),section.querySelector("#edit-email").addEventListener("click",(t=>{window.location.hash="#/update-email"})),section.querySelector("#edit-password").addEventListener("click",(t=>{window.location.hash="#/update-password"})),section.querySelector("#tfa-none").addEventListener("click",(()=>{C("none")})),section.querySelector("#tfa-email").addEventListener("click",(()=>{C("email")})),section.querySelector("#tfa-authenticator").addEventListener("click",(()=>{C("authenticator")})),section.querySelector(".delete-account").addEventListener("click",(t=>{window.location.hash="#/delete-account"}))};function H(t,e,n,o=""){console.log("Setting up camembert animation");const a=t.querySelector(".camembert-stat");if(!a)return void console.error("Camembert container not found");console.log("Camembert container found",a),a.innerHTML="";const s=a.getBoundingClientRect().width,i=s/2;!function(t,e,n,o,a){let s=document.createElement("div");s.style.width=0,s.style.height=0,s.style.left=e+"px",s.style.top=n+"px",s.style.borderRadius="50%",s.style.position="absolute",s.style.transition="width 0.5s ease, height 0.5s ease, left 0.5s ease, top 0.5s ease",t.appendChild(s),console.log("Circle div added to DOM:",s),setTimeout((()=>{s.style.width=2*o+"px",s.style.height=2*o+"px",s.style.left=e-o+"px",s.style.top=n-o+"px",console.log("Circle animation started"),a(s)}),100)}(a,i,i,i,(t=>{o?function(t,e,n){const o=e/2,a=o,s=`\n       <svg width="${e}" height="${e}" viewBox="0 0 ${e} ${e}" xmlns="http://www.w3.org/2000/svg">\n           <circle cx="${a}" cy="${a}" r="${o}" fill="#9e9d9d" style="transform-origin: ${a}px ${a}px; transform: scale(0); transition: transform 0.5s ease;"/>\n           <text x="${a}" y="${a}" text-anchor="middle" dominant-baseline="middle" font-size="10" fill="black" style="opacity: 0; transition: opacity 0.5s ease 0.5s;">\n               ${n}\n           </text>\n       </svg>\n   `;t.innerHTML=s,setTimeout((()=>{const e=t.querySelector("circle"),n=t.querySelector("text");e.style.transform="scale(1)",console.log("Full circle animation started"),setTimeout((()=>{n.style.opacity=1,console.log("Text animation started")}),510)}),10)}(t,s,o):setTimeout((()=>{!function(t,e,n,o){const a=e/2,s=a,i=n/100*360,r=i*Math.PI/180,l=`\n       <svg width="${e}" height="${e}" viewBox="0 0 ${e} ${e}" xmlns="http://www.w3.org/2000/svg">\n           <circle cx="${s}" cy="${s}" r="${a}" fill="transparent"/>\n           <circle cx="${s}" cy="${s}" r="${a}" fill="#63aa63" style="transform-origin: ${s}px ${s}px; transform: scale(0); transition: transform 0.5s ease;"/>\n           <path d="\n       M ${s},${s}\n       L ${s},${s-a}\n       A ${a},${a} 0 ${i>180?1:0} 1 ${s+a*Math.cos(r-Math.PI/2)},${s+a*Math.sin(r-Math.PI/2)}\n       Z\n   " fill="${o}" style="transform-origin: ${s}px ${s}px; transform: scale(0); transition: transform 0.5s ease 0.5s;"/>\n       </svg>\n   `;t.innerHTML=l,setTimeout((()=>{t.querySelector("circle:nth-of-type(2)").style.transform="scale(1)",console.log("Full circle animation started")}),10),setTimeout((()=>{t.querySelector("path").style.transform="scale(1)",console.log("Sector animation started")}),510)}(t,s,e,n)}),500)}))}const U=`${window.location.protocol}//${window.location.host}/api/users`,J=t=>{setTimeout((()=>{t.querySelectorAll(".stat-number").forEach((t=>{const e=+t.getAttribute("data-target");((t,e)=>{let n=0;const o=e/100,a=setInterval((()=>{n+=o,n>=e&&(clearInterval(a),n=e),t.textContent=Math.floor(n)}),10)})(t,e)})),console.log("Animation set")}),500)},W=(t,e,n)=>{let o=0,a="#b26969",s="";0!==e?o=99.9999*(e-n)/e:s="aucune partie jouée",H(t,o,a,s),window.addEventListener("resize",(()=>{H(t,o,a,s)}))},V=`${window.location.protocol}//${window.location.host}/api/users`,Z=()=>{let t=document.createElement("div");return console.log("Creating form element"),T(`${V}/me/`).then((t=>{if(!t.ok)throw new Error("Failed to fetch user profile");return t.json()})).then((e=>{console.log("Fetched user data:",e),t.innerHTML=`\n\t\t\t<div class="stat-container">\n\t\t\t\t<div class="id">\n\t\t\t\t\t<div><img src="${e.avatar}" alt="profile-pic" class="profile-picture"></div>\n\t\t\t\t\t\n\t\t\t\t\t<div class="text-stat">\n\t\t\t\t\t\t<div class="name-and-settings">\n\t\t\t\t\t\t\t<div class="username-stat">${e.username}</div>\n\t\t\t\t\t\t\t<a class="nav-link" href="#/settings"><i class="bi bi-gear-fill gear-icon"></i></a>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="status">\n\t\t\t\t\t\t\t<div class="dropdown">\n\t\t\t\t\t\t\t\t<button class="btn btn-secondary dropdown-toggle transparent-dropdown d-flex align-items-center" type="button"\n\t\t\t\t\t\t\t\t\tid="dropdownMenuButton1" data-bs-toggle="dropdown" aria-expanded="false">\n\t\t\t\t\t\t\t\t\t<div class="status-dropdown">\n\t\t\t\t\t\t\t\t\t\t<div class="status-pastille" style="background-color: ${A(e.status)};"></div>\n\t\t\t\t\t\t\t\t\t\t<div class="status-text">${e.status}</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t<ul class="dropdown-menu transparent-dropdown" aria-labelledby="dropdownMenuButton1">\n\t\t\t\t\t\t\t\t\t<li class="dropdown-item" data-status="online">\n\t\t\t\t\t\t\t\t\t\t<div class="status-dropdown">\n\t\t\t\t\t\t\t\t\t\t\t<div class="status-pastille" style="background-color: green; margin-right: 0.3vw"></div>\n\t\t\t\t\t\t\t\t\t\t\t<div class="status-text">Online</div>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t\t\t<li class="dropdown-item" data-status="offline">\n\t\t\t\t\t\t\t\t\t\t<div class="status-dropdown">\n\t\t\t\t\t\t\t\t\t\t\t<div class="status-pastille" style="background-color: grey; margin-right: 0.3vw"></div>\n\t\t\t\t\t\t\t\t\t\t\t<div class="status-text">Offline</div>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t\t</ul>\n\t\t\t\t\t\t\t</div>            \n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t<div class="statistics-box">\n\t\t\t\t\t<div class="left-side">\n\t\t\t\t\t\t<div class="stat-title">Statistiques du joueur :</div>\n\t\t\t\t\t\t<div class="camembert-stat"></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="middle">\n            \t\t    <div class="legend-stat">\n                    \t\t<div style="width: 1vw; height: 1vw; background-color: #63aa63; margin-right: 0.5vw; border-radius: 50%; margin-top: 0.2vw;"></div>\n                    \t\t<p style="color: white;">victoires:&nbsp;</p>\n\t\t\t\t\t\t\t<p style="color: green;">${e.won_games}</p>\n                \t\t</div>\n                \t\t<div class="legend-stat">\n                    \t\t<div style="width: 1vw; height: 1vw; background-color: #b26969; margin-right: 0.5vw; border-radius: 50%; margin-top: 0.2vw;"></div>\n                    \t\t<p style="color: white;">défaites:&nbsp;</p>\n\t\t\t\t\t\t\t<p style="color: red;">${e.played_games-e.won_games}</p>\n                \t\t</div>\n            \t\t</div>\n\t\t\t\t\t<div class="right-side">\n\t\t\t\t\t\t<div class="stat-data">\n\t\t\t\t\t\t\t<div class="stat-rubric-stat">\n\t\t\t\t\t\t\t\t<p class="stat-text">Points marqués</p>\n\t\t\t\t\t\t\t\t<p class="stat-number" data-target="${e.scored_points}">0</p>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="stat-rubric-stat">\n\t\t\t\t\t\t\t\t<p class="stat-text">Points concédés</p>\n\t\t\t\t\t\t\t\t<p class="stat-number" data-target="${e.conceded_points}">0</p>\n\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="stat-rubric-stat">\n\t\t\t\t\t\t\t\t<p class="stat-text">Victoires parfaites</p>\n\t\t\t\t\t\t\t\t<p class="stat-number" data-target="${e.perfect_wins}">0</p>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t<div class="footer-link">\n\t\t\t\t\t<div class="search-container">\n            \t\t\t<div class="search-barre">\n                \t\t\t<input type="text" id="login-search" placeholder="Entrez le nom de l'utilisateur">\n            \t\t\t</div>\n            \t\t\t<button type="button" id="search-button">\n                \t\t\t<i class="bi bi-search search-icon"></i>\n            \t\t\t</button>\n        \t\t\t</div>\n\t\t\t\t\t<a class="nav-link" href="#/friendlist">         \n\t\t\t\t\t\t<div class="footer" id="list-stat">\n\t\t\t\t\t\t\t<i class="bi bi-list-task footer-icon"></i>\n\t\t\t\t\t\t\t<p class="footer-text">Liste d'amis</p>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</a>\n\t\t\t\t\t<a class="nav-link" href="#/gamehistory">         \n\t\t\t\t\t\t<div class="footer" id="history-stat">\n\t\t\t\t\t\t\t<i class="bi bi-clock-history footer-icon"></i>\n\t\t\t\t\t\t\t<p class="footer-text">Historique des parties</p>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</a>\n\t\t\t\t</div>\n\t\t\t</div>\n        `,console.log("Form innerHTML set"),J(t),((t,e)=>{t.querySelectorAll(".dropdown-item").forEach((e=>{e.addEventListener("click",(()=>{const n=e.getAttribute("data-status");_(`${U}/update-status/`,{status:n}).then((t=>{if(!t.ok)throw new Error("Failed to update user status");return t.json()})).then((()=>{const e=t.querySelector(".status-text"),o=t.querySelector(".status-pastille");e&&o&&(e.innerText=n,o.style.backgroundColor=A(n))})).catch((t=>{console.error("Error updating status:",t)}))}))}))})(t,e.status),console.log("Event listeners set");const n=t.querySelector("#login-search");t.querySelector("#search-button").addEventListener("click",(()=>{z(n,e.username)})),n.addEventListener("keydown",(t=>{"Enter"===t.key&&z(n,e.username)})),W(t,e.played_games,e.won_games)})).catch((e=>{console.error("Error fetching user profile:",e),t.innerHTML="<p>Failed to load user profile</p>"})),t},X=`${window.location.protocol}//${window.location.host}/api/users`,G=async()=>{let t=document.querySelector("#section");if(!await S())throw new Error("User is not authenticated");T(`${X}/me/`).then((t=>{if(!t.ok)throw new Error("Failed to fetch user profile");return t.json()})).then((e=>{console.log("Fetched user data:",e);const n=e.mail_confirmation_status?"":'\n           <div class="confirm-email">\n               votre adresse mail doit etre verifiee : \n               <a href="" id="resend-verification-email">envoyer un mail de verification</a>\n           </div>';t.innerHTML=` \n        <div class="settings-container">\n            <h1 class="settings-title">Parametres du compte</h1>\n            <div class="settings-box">\n            <div class="editting">\n               <div class="picture-wrapper">\n                   <img src="${e.avatar}" class="settings-picture" alt="settings-pic">\n                   <a href="#" class="edit-pp">modifier</a>\n               </div>\n               <input type="file" id="avatar-input" style="display: none;" accept="image/*">\n            </div>\n            <div class="all-modif">\n               <div class="modif-user">\n                   <div class="modif-username">\n                       <p class="current-data">${e.username}</p>\n                       <button href="#/update-username" type="button" class="btn btn-light btn-modif-settings"\n                           id="edit-username">modifier\n                           username</button>\n                   </div>\n                   <div class="modif-username">\n                       <p class="current-data">${e.email}</p>\n                       <button href="#/update-email" type="button" class="btn btn-light btn-modif-email"\n                           id="edit-email">modifier\n                           adresse\n                           mail</button>\n                   </div>\n                   <div class="modif-username">\n                       <p class="current-data">********</p>\n                       <button href="#/update-password" type="button" class="btn btn-light btn-modif-psw"\n                           id="edit-password">modifier\n                           mot\n                           de passe</button>\n                   </div>\n               </div>\n               <div class="modif-website">\n                   <div class="dropdown drop-settings">\n                       <button class="btn btn-secondary dropdown-toggle set-drop" type="button"\n                           id="dropdownMenuButton1" data-bs-toggle="dropdown" aria-expanded="false">\n                           methode 2fa\n                       </button>\n                       <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton1">\n                           <li><a class="dropdown-item" id="tfa-none">aucune</a></li>\n                           <li><a class="dropdown-item" id="tfa-email">mail</a></li>\n                           <li><a class="dropdown-item" id="tfa-authenticator">qrcode</a></li>\n                       </ul>\n                   </div>\n\n                   <div class="dropdown drop-settings">\n                       <button class="btn btn-secondary dropdown-toggle set-drop" type="button"\n                           id="dropdownMenuButton1" data-bs-toggle="dropdown" aria-expanded="false">\n                           couleur de l'arriere plan\n                       </button>\n                       <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton1">\n                           <li><a class="dropdown-item" href="#/settings" data-bg-class="bg-nagoya">Nagoya</a></li>\n                           <li><a class="dropdown-item" href="#/settings" data-bg-class="bg-roland">Roland</a></li>\n                           <li><a class="dropdown-item" href="#/settings" data-bg-class="bg-wimbledon">Wimbledon</a></li>\n                       </ul>\n                   </div>\n\n               </div>\n           </div>\n           <button type="button" href="#" class="btn btn-danger delete-account">supprimer le compte</button>\n\n       </div>\n\n       <div class="settings-footer">\n           <div class="search-container">\n               <div class="search-barre">\n                   <input type="text" id="login-search" placeholder="Entrez le nom de l'utilisateur">\n               </div>\n               <button type="button" id="search-button">\n                   <i class="bi bi-search search-icon"></i>\n               </button>\n            </div>\n\n           <a class="nav-link" href="#/chartemsg">\n               <div class="charte-footer" id="list-stat">\n                   <i class="bi bi-file-earmark-lock settings-footer-icon"></i>\n                   <p class="settings-footer-text">Charte de confidentialite</p>\n               </div>\n           </a>\n       </div>\n       ${n}\n\n   </div>\n       `,t.querySelector(".edit-pp").addEventListener("click",(e=>{e.preventDefault(),t.querySelector("#avatar-input").click()})),t.querySelector("#avatar-input").addEventListener("change",(t=>{const e=t.target.files[0];e&&(t=>{const e=new FormData;e.append("avatar",t),fetch(`${M}/update-avatar/`,{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")}`},body:e}).then((t=>{if(413===t.status)throw new Error("Le fichier est trop grand. Veuillez choisir un fichier plus petit.");return t.ok?t.json():t.json().then((t=>{throw new Error(t.error||"Échec de la mise à jour de l'avatar")}))})).then((t=>{document.querySelector(".settings-picture").src=t.avatar,alert("Avatar mis à jour avec succès"),window.location.reload()})).catch((t=>{console.error("Erreur lors de la mise à jour de l'avatar:",t),alert(`Une erreur s'est produite lors de la mise à jour de l'avatar : ${t.message}`)}))})(e)}));const o=t.querySelector("#login-search");var a;t.querySelector("#search-button").addEventListener("click",(()=>{z(o,e.username)})),o.addEventListener("keydown",(t=>{"Enter"===t.key&&z(o,e.username)})),R(),a=e.two_fa_method,document.querySelectorAll(".dropdown-item").forEach((t=>{t.classList.remove("active-2fa")})),document.querySelector(`#tfa-${a}`).classList.add("active-2fa"),0==e.mail_confirmation_status&&t.querySelector("#resend-verification-email").addEventListener("click",(t=>{var n;t.preventDefault(),n=e.email,console.log("Send Mail"),I(`${j}/send-confirmation-email/`,{email:n}).then((t=>{if(!t.ok)return t.json().then((t=>{alert(`Error: ${t.error||"Failed to send confirmation email"}`)}));alert("Confirmation email sent")})).catch((t=>{console.error("Error sending confirmation email:",t),alert("An error occurred while sending the confirmation email")}))})),N()})).catch((e=>{console.error("Error fetching user profile:",e),t.innerHTML="<p>Failed to load user profile</p>"}))},Q=n.p+"images/2e33b274de877244a3da.png",Y=n.p+"images/ce111bc7f40343a05d42.jpg",K=n.p+"images/0d8fb09bbcf1530a9616.png",tt=n.p+"images/54682494f24ad7a85dec.png",et=`${window.location.protocol}//${window.location.host}/api/users`,nt=()=>{console.log("enter in friendprofile component");let t=document.createElement("div");const e=window.location.hash.split("/"),n=e[e.length-1];return T(`${et}/${n}/`).then((t=>t.json())).then((e=>{if("No User matches the given query."===e.detail)throw new Error("L'utilisateur n'existe pas");console.log("Fetched user data:",e),t.innerHTML=`\n            <div class="stat-container">\n\t\t\t\t<div class="id">\n\t\t\t\t\t<div><img src="${e.avatar}" alt="profile-pic" class="profile-picture"></div>\n\t\t\t\t\t\n\t\t\t\t\t<div class="text-stat">\n\t\t\t\t\t\t<div class="friend-name">\n\t                        <p class="profile-text">Profil de</p>\n\t\t\t\t\t\t\t<div class="friend-username-stat">${e.username}</div>\n\t\t\t\t\t\t</div>\n                        <div class="status">\n                            <div class="status-pastille" style="background-color: ${A(e.status)}; margin-top: 0.5vh;"></div>\n                            <div class="friend-status-text">${e.status}</div>\n                            <a class="nav-link" href="#" id="delete-friend-btn"><i class="bi bi-person-dash-fill person-icon delete-icon"></i></a>\n                            <a class="nav-link" href="#" id="add-friend-btn"><i class="bi bi-person-plus-fill person-icon"></i></a>\n                        </div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t<div class="statistics-box">\n\t\t\t\t\t<div class="left-side">\n\t\t\t\t\t\t<div class="stat-title">Statistiques du joueur :</div>\n\t\t\t\t\t\t<div class="camembert-stat"></div>\n\t\t\t\t\t</div>\n                    <div class="middle">\n            \t\t    <div class="legend-stat">\n                    \t\t<div style="width: 1vw; height: 1vw; background-color: #63aa63; margin-right: 0.5vw; border-radius: 50%; margin-top: 0.2vw;"></div>\n                    \t\t<p>victoires</p>\n                \t\t</div>\n                \t\t<div class="legend-stat">\n                    \t\t<div style="width: 1vw; height: 1vw; background-color: #b26969; margin-right: 0.5vw; border-radius: 50%; margin-top: 0.2vw;"></div>\n                    \t\t<p>défaites</p>\n                \t\t</div>\n            \t\t</div>\n\t\t\t\t\t<div class="right-side">\n\t\t\t\t\t\t<div class="stat-data">\n\t\t\t\t\t\t\t<div class="stat-rubric-stat">\n\t\t\t\t\t\t\t\t<p class="stat-text">Points marqués :</p>\n\t\t\t\t\t\t\t\t<p class="stat-number" data-target="${e.scored_points}">0</p>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="stat-rubric-stat">\n\t\t\t\t\t\t\t\t<p class="stat-text">Points concédés :</p>\n\t\t\t\t\t\t\t\t<p class="stat-number" data-target="${e.conceded_points}">0</p>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="stat-rubric-stat">\n\t\t\t\t\t\t\t\t<p class="stat-text">Victoires parfaites :</p>\n\t\t\t\t\t\t\t\t<p class="stat-number" data-target="${e.perfect_wins}">0</p>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t<div class="footer-friend-link">\n\t\t\t\t\t<div class="search-container">\n            \t\t\t<div class="search-barre">\n                \t\t\t<input type="text" id="login-search" placeholder="Entrez le nom de l'utilisateur">\n            \t\t\t</div>\n            \t\t\t<button type="button" id="search-button">\n                \t\t\t<i class="bi bi-search search-icon"></i>\n            \t\t\t</button>\n        \t\t\t</div>\n\t\t\t\t\t<a class="nav-link" href="#/publicgamehistory/${e.username}">         \n\t\t\t\t\t\t<div class="footer-friend" id="history-stat">\n\t\t\t\t\t\t\t<i class="bi bi-clock-history footer-friend-icon"></i>\n\t\t\t\t\t\t\t<p class="footer-friend-text">Historique des parties de ${e.username}</p>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</a>\n\t\t\t\t</div>\n\n\t\t\t</div>\n            `,J(t),W(t,e.played_games,e.won_games);const o=t.querySelector("#login-search");t.querySelector("#search-button").addEventListener("click",(()=>{z(o,e.username)})),o.addEventListener("keydown",(t=>{"Enter"===t.key&&z(o,e.username)})),document.getElementById("delete-friend-btn").addEventListener("click",(t=>{t.preventDefault(),function(t){x(`${F}/unfriend/${t}/`).then((t=>t.ok?t.json():t.json().then((t=>{throw new Error(t.detail||"Failed to remove friend")})))).then((t=>{console.log(t),alert("Friend removed successfully")})).catch((t=>{console.error("Error removing friend:",t),alert(t.message||"Failed to remove friend")}))}(n)})),document.getElementById("add-friend-btn").addEventListener("click",(t=>{t.preventDefault(),function(t){I(`${F}/add-friend/${t}/`).then((t=>t.ok?t.json():t.json().then((t=>{throw new Error(t.detail||"Failed to add friend")})))).then((t=>{console.log(t),alert("Friend added successfully")})).catch((t=>{console.error("Error adding friend:",t),alert(t.message||"Failed to add friend")}))}(n)}))})).catch((t=>{console.error("Error fetching user profile:",t),alert("L'utilisateur n'existe pas"),window.location.href="#/dashboard"})),t},ot=`${window.location.protocol}//${window.location.host}/api/users`;const at=`${window.location.protocol}//${window.location.host}/api/users`,st=async()=>{d();try{const t=await T(`${at}/friendlist/`);if(!t.ok)throw new Error("Failed to fetch user friendlist");const e=await t.json(),n=Array.isArray(e)?e:[],o=n.map((t=>`\n            <tr class="friend-row">\n                <td>\n                    <a href="#/friendprofile/${t.username}">\n                        <img src="${t.avatar}" alt="${t.username}">\n                    </a>\n                </td>\n                <td>\n                    <span class="status-circle" style="background-color: ${function(t){switch(t){case"online":return"green";case"offline":default:return"grey";case"in-game":return"orange"}}(t.status)};" data-tooltip="${function(t){switch(t){case"online":return"En ligne";case"offline":return"Déconnecté";case"in-game":return"En partie";default:return"Unknown Status"}}(t.status)}"></span>\n                </td>\n                <td>\n                    <a href="#/friendprofile/${t.username}" class="userf">${t.username}</a>\n                </td>\n                <td>\n                    <span class="remove-btnf" data-username="${t.username}">&times;</span>\n                </td>\n            </tr>\n        `)).join("");let a=document.querySelector("#section");a&&(a.innerHTML=`\n                <div class="main-containerf fl-hidden">\n                    <div class="friends-containerf">\n                        <h2 class="titlef">LISTE D'AMIS</h2>\n                        <a class="nav-link" href="#/dashboard">\n                            <span class="close-btnf">&times;</span>\n                        </a>\n                        <table class="friends-tablef">\n                            <tbody>\n                                ${o}\n                            </tbody>\n                        </table>\n                        <div class="friend-count">\n                            Nombre d'amis: ${n.length}\n                        </div>\n                    </div>\n                </div>\n            `);const s=document.querySelector(".main-containerf");s&&setTimeout((()=>{s.classList.add("fl-visible"),s.classList.remove("fl-hidden")}),100);document.querySelectorAll(".remove-btnf").forEach((t=>{t.addEventListener("click",(async e=>{const n=t.getAttribute("data-username");await(async t=>{try{const e=await x(`${ot}/unfriend/${t}/`);if(!e.ok){const t=await e.json();throw new Error(t.detail||"Failed to remove friend")}const n=await e.json();console.log(n),alert("Friend removed successfully")}catch(t){console.error("Error removing friend:",t),alert(t.message||"Failed to remove friend")}})(n),st()}))}))}catch(t){console.error("Error fetching friend list:",t)}},it=`${window.location.protocol}//${window.location.host}/api/users`,rt=`${window.location.protocol}//${window.location.host}/api/users`,lt=`${window.location.protocol}//${window.location.host}/api/auth`,ct=`${window.location.protocol}//${window.location.host}/api/auth`,dt=`${window.location.protocol}//${window.location.host}/api/auth`,ut=async()=>{try{if(!(await I(`${dt}/signout/`)).ok)throw new Error("Failed to logout");localStorage.removeItem("accessToken"),localStorage.removeItem("refreshToken"),window.location.href="#/"}catch(t){console.error("Logout error:",t),alert("An error occurred while logging out. Please try again.")}},mt=`${window.location.protocol}//${window.location.host}/api/users`,pt=async()=>{d();let t=document.querySelector("#section");return t.innerHTML='\n    <div class="container-update-data">\n        <div class="update-data-form">\n            <h1 class="title-update-data">Modifier le Nom d\'utilisateur</h1>\n            <input type="text" id="new-data" class="input-update-data" placeholder="Nouveau nom d\'utilisateur" required>\n            <input type="password" id="password" class="input-update-data" placeholder="Mot de passe" required>\n            <button class="button-update-data" id="submit-update-username">Mettre à jour</button>\n            <button class="button-update-data" id="cancel-update-username">Annuler</button>\n        </div>\n    </div>\n    ',document.getElementById("submit-update-username").addEventListener("click",(async()=>{const t=document.getElementById("new-data").value,e=document.getElementById("password").value;if(t&&e)try{const n=await _(`${mt}/update-username/`,{username:t,password:e});if(n.ok)await n.json(),alert("Username updated successfully"),window.location.hash="#/settings";else{const t=await n.json();alert(`Error: ${t.error||"Failed to update username"}`)}}catch(t){console.error("Error updating username:",t),alert("An error occurred while updating the username")}else alert("Please enter both username and password")})),document.getElementById("cancel-update-username").addEventListener("click",(()=>{window.location.hash="#/settings"})),t},vt=async()=>{d();let t=document.querySelector("#section");return t.innerHTML='\n        <div class="container-update-data">\n            <div class="update-data-form">\n                <h1 class="title-update-data">Modifier l\'adresse mail</h1>\n                <input type="text" id="new-data" class="input-update-data" placeholder="Nouvelle adresse mail" required>\n                <input type="password" id="password" class="input-update-data" placeholder="Mot de passe" required>\n                <button class="button-update-data" id="submit-update-email">Mettre à jour</button>\n                <button class="button-update-data" id="cancel-update-email">Annuler</button>\n            </div>\n        </div>\n    ',document.getElementById("submit-update-email").addEventListener("click",(async()=>{const t=document.getElementById("new-data").value,e=document.getElementById("password").value;if(t&&e)try{const n=await _(`${mt}/update-email/`,{email:t,password:e});if(n.ok)await n.json(),alert("Email updated successfully"),window.location.hash="#/settings";else{const t=await n.json();alert(`Error: ${t.error||"Failed to update email"}`)}}catch(t){console.error("Error updating email:",t),alert("An error occurred while updating the email")}else alert("Please enter both email and password")})),document.getElementById("cancel-update-email").addEventListener("click",(()=>{window.location.hash="#/settings"})),t},ht=async()=>{d();let t=document.querySelector("#section");return t.innerHTML='\n        <div class="container-update-data">\n            <div class="update-data-form">\n                <h1 class="title-update-data">Modifier le Mot de Passe</h1>\n                <input type="password" id="current-password" class="input-update-data" placeholder="Mot de passe actuel" required>\n                <input type="password" id="new-password" class="input-update-data" placeholder="Nouveau mot de passe" required>\n                <input type="password" id="confirm-password" class="input-update-data" placeholder="Confirmation mdp" required>\n                <button class="button-update-data" id="submit-update-password">Mettre à jour</button>\n                <button class="button-update-data" id="cancel-update-password">Annuler</button>\n            </div>\n        </div>\n    ',document.getElementById("submit-update-password").addEventListener("click",(async()=>{const t=document.getElementById("current-password").value,e=document.getElementById("new-password").value,n=document.getElementById("confirm-password").value;if(t&&e&&n)if(e===n)try{const n=await _(`${mt}/update-password/`,{current_password:t,new_password:e});if(n.ok)alert("Password updated successfully"),window.location.hash="#/settings";else{const t=await n.json();alert(`Error: ${t.current_password||t.new_password||"Failed to update password"}`)}}catch(t){console.error("Error updating password:",t),alert("An error occurred while updating the password")}else alert("New password and confirmation do not match");else alert("Please enter all fields")})),document.getElementById("cancel-update-password").addEventListener("click",(()=>{window.location.hash="#/settings"})),t},gt=`${window.location.protocol}//${window.location.host}/api/auth`,ft=async()=>{d();let t=document.querySelector("#section");return t.innerHTML='\n        <div class="container-update-data">\n            <div class="update-data-form">\n                <h1 class="title-update-data">Supprimer le Compte</h1>\n                <p>Veuillez entrer votre mot de passe pour confirmer la suppression du compte.</p>\n                <input type="password" id="delete-password" class="input-update-data" placeholder="Mot de passe" required>\n                <button class="button-update-data" id="submit-delete-account">Supprimer le compte</button>\n                <button class="button-update-data" id="cancel-delete-account">Annuler</button>\n            </div>\n        </div>\n    ',document.getElementById("submit-delete-account").addEventListener("click",(async()=>{const t=document.getElementById("delete-password").value;if(t){if(confirm("Êtes-vous sûr de vouloir supprimer votre compte ? Cette action est irréversible."))try{const e=await x(`${gt}/delete-user/`,{password:t});if(e.ok)alert("Compte supprimé avec succès"),localStorage.removeItem("accessToken"),localStorage.removeItem("refreshToken"),window.location.hash="#/";else{const t=await e.json();alert(`Erreur : ${t.error||"Échec de la suppression du compte"}`)}}catch(t){console.error("Error deleting account:",t),alert("Une erreur est survenue lors de la suppression du compte")}}else alert("Veuillez entrer votre mot de passe")})),document.getElementById("cancel-delete-account").addEventListener("click",(()=>{window.location.hash="#/settings"})),t},wt=`${window.location.protocol}//${window.location.host}/api/auth`,bt=["#/game","#/dashboard","#/settings","#/aboutus","#/chartemsg","#/friendlist","#/gamehistory"],yt=["#/friendprofile","#/publicgamehistory"],Et=`${window.location.protocol}//${window.location.host}/api/auth`,kt=async()=>{const t=window.location.hash;console.log("current hash: ",t);const e=document.getElementById("section");window.isInternalNavigation=!0;const n=bt.includes(t),a=yt.some((e=>t.startsWith(e)));if(window.onbeforeunload=n||a?function(t){I(`${Et}/signout/`)}:null,window.location.hash.includes("access")&&window.location.hash.includes("refresh"))return console.log("handling callback"),void await function(){console.log("handleCallback()");const t=window.location.hash.substring(1);console.log("Fragment part of URL:",t);const e=new URLSearchParams(t),n=e.get("access"),o=e.get("refresh"),a=e.get("message");if(n&&o){console.log("Tokens found in URL parameters:",n,o);try{localStorage.setItem("accessToken",n),localStorage.setItem("refreshToken",o),console.log("Tokens stored successfully in local storage.")}catch(t){console.error("Error storing tokens in local storage:",t)}a&&alert(a),window.location.href=`${s}/#/dashboard`}else console.log("No tokens found in URL parameters.")}();"#/"===t?u():"#/signin"===t?(()=>{d();let t=document.querySelector("#section");if(t){t.innerHTML=`\n            <div class="balls-signin d-none d-md-flex">\n                <div class="white-ball-signin"></div>\n                <div class="orange-ball-signin">\n                    <form id="signin-form" class="login-form-signin">\n                        <input type="text" id="username" class="login-input-signin" placeholder="nom d'utilisateur">\n                        <input type="email" id="email" class="login-input-signin" placeholder="email">\n                        <input type="password" id="password" class="login-input-signin" placeholder="mot de passe">\n                        <input type="password" id="confirmPassword" class="login-input-signin" placeholder="confirmer mdp">\n                        <button type="submit" class="button-signin">s'inscrire</button>\n                    </form>\n                    <a class="nav-link" href="#/">\n                        <div class="arrow-s"><i class="bi bi-arrow-left-circle-fill"></i></div>\n                    </a>\n                </div>\n                <div class="btn-container-home">\n                    <button id="fortyTwoSignInBtn" class="btn-42-home">\n                        <p class="co-42-home">connexion avec</p>\n                        <img src="${o}" class="img-42-home" alt="button-42">\n                    </button>\n                </div>\n            </div>\n\n            <div class="balls-signin d-none d-sm-flex d-md-none">\n                <a class="nav-link" href="#/">\n                    <div class="arrow-s-sm"><i class="bi bi-arrow-left-circle-fill"></i></div>\n                </a>\n                <div class="orange-ball-signin-sm">\n                    <form id="signin-form-sm" class="login-form-signin">\n                        <input type="text" id="username-sm" class="login-input-signin" placeholder="nom d'utilisateur">\n                        <input type="email" id="email-sm" class="login-input-signin" placeholder="email">\n                        <input type="password" id="password-sm" class="login-input-signin" placeholder="mot de passe">\n                        <input type="password" id="confirmPassword-sm" class="login-input-signin" placeholder="confirmer mdp">\n                        <button type="submit" class="button-signin">s'inscrire</button>\n                    </form>\n                </div>\n            </div>\n        `,y(),window.addEventListener("resize",y);const e=document.getElementById("fortyTwoSignInBtn");e&&e.addEventListener("click",(()=>{i()}))}})():"#/login"===t?(()=>{d();let t=document.querySelector("#section");if(t){t.innerHTML=`\n            <div class="balls-login d-none d-md-flex">\n                <div class="orange-ball-login">\n                    <a class="nav-link" href="#/">\n                        <div class="arrow"><i class="bi bi-arrow-left-circle-fill"></i></div>\n                    </a>\n                </div>\n                <div class="white-ball-login">\n                    <form id="login-form" class="login-form-login">\n                        <input type="text" id="username" class="login-input" placeholder="Username">\n                        <input type="password" id="password" class="login-input" placeholder="Password">\n                        <button type="submit" class="button-login">se connecter</button>\n                    </form>\n                </div>\n                <div class="btn-container-home">\n                    <button id="fortyTwoSignInBtn" class="btn-42-home">\n                        <p class="co-42-home">connexion avec</p>\n                        <img src="${o}" class="img-42-home" alt="button-42">\n                    </button>\n                </div>\n            </div>\n\n            <div class="balls-login d-flex d-md-none">\n                <a class="nav-link" href="#/">\n                    <div class="arrow-sm"><i class="bi bi-arrow-left-circle-fill"></i></div>\n                </a>\n                <div class="white-ball-login-sm">\n                    <form id="login-form-sm" class="login-form-login">\n                        <input type="text" id="username-sm" class="login-input" placeholder="Username">\n                        <input type="password" id="password-sm" class="login-input" placeholder="Password">\n                        <button type="submit" class="button-login">se connecter</button>\n                    </form>\n                </div>\n            </div>\n        `,g(),window.addEventListener("resize",g);const e=document.getElementById("fortyTwoSignInBtn");e&&e.addEventListener("click",(()=>{i()}))}})():"#/game"===t?B():"#/dashboard"===t?(async()=>{if(!await S())throw new Error("User is not authenticated");let t=document.querySelector("#section");t.innerHTML="",t.append(Z())})():"#/settings"===t?G():"#/aboutus"===t?(async()=>{if(!await S())throw new Error("User is not authenticated");let t=document.querySelector("#section");t&&(t.innerHTML=`\n\t    <div class="main-container-aboutus">\n\n        <h1 class="title-aboutus">Qui sommes nous ?</h1>\n\t    <div class="container-aboutus">\n\t    \t<div class="row">\n\t    \t\t<div id="block2" class="col-md-6 col-lg-6 mb-3">\n\t\t\t\t\t<a target="_blank" class="nav-link" href="https://fr.linkedin.com/in/hugo-coulon-03a577294">\n\t\t    \t\t\t<div class="frame-aboutus">\n\t\t    \t\t\t\t<h1 class="name-cube">Hugo COULON</h1>\n\t    \t\t\t\t\t<img class="img-us" src="${Q}" alt="img-hugo">\n\t    \t\t\t\t\t<p>Développement du jeu</p>\n\t    \t\t\t\t</div>\n\t\t\t\t\t</a>\n\t    \t\t</div>\n\t    \t\t<div id="block3" class="col-md-6 col-lg-6 mb-3">\n\t\t\t\t\t<a target="_blank" class="nav-link" href="https://fr.linkedin.com/in/tasnim-mejri-5a8460211?original_referer=https%3A%2F%2Fwww.google.com%2F">\n\t\t    \t\t\t<div class="frame-aboutus">\n\t\t    \t\t\t\t<h1 class="name-cube">Tasnim MEJRI</h1>\n\t    \t\t\t\t\t<img class="img-us" src="${Y}" alt="img-tasnim">\n\t    \t\t\t\t\t<p>Développement du frontend</p>\n\t    \t\t\t\t</div>\n\t\t\t\t\t</a>\n\t    \t\t</div>\n\t    \t\t<div id="block4" class="col-md-6 col-lg-6 mb-3">\n\t\t\t\t\t<a target="_blank" class="nav-link" href="https://fr.linkedin.com/in/alexandre-selnet-1a1714317">\n\t    \t\t\t\t<div class="frame-aboutus">\n\t    \t\t\t\t\t<h1 class="name-cube">Alexandre SELNET</h1>\n\t    \t\t\t\t\t<img class="img-us" src="${K}" alt="img-alex">\n\t    \t\t\t\t\t<p>Développement Fullstack</p>\n\t    \t\t\t\t</div>\n\t\t\t\t\t</a>\n\t    \t\t</div>\n\t    \t\t<div id="block5" class="col-md-6 col-lg-6 mb-3">\n\t\t\t\t\t<a target="_blank" class="nav-link" href="https://fr.linkedin.com/in/jules-thuysbaert-535723204">\n\t    \t\t\t\t<div class="frame-aboutus">\n\t    \t\t\t\t\t<h1 class="name-cube">Jules THUYSBAERT</h1>\n\t    \t\t\t\t\t<img class="img-us" src="${tt}" alt="img-jules">\n\t    \t\t\t\t\t<p>Développement du backend</p>\n\t    \t\t\t\t</div>\n\t\t\t\t\t</a>\n\t    \t\t</div>\n    \t\t</div>\n\t    </div>\n\t    </div>\n    `)})():"#/friendlist"===t?st():"#/gamehistory"===t?(async()=>{d();try{const t=await T(`${it}/game-history/`);if(!t.ok)throw new Error("Failed to fetch game history");const e=await t.json(),n=Array.isArray(e)?e:[],o=e.length>0?e[0].user:"",a=n.map((t=>{const e=t.winner_avatar,n=t.loser_avatar,a=t.local_game?"Locale":"Online",s=t.winner===o?"Victory":"Defeat",i=t.winner===o?"victory":"defeat";return`\n                <tr>\n                    <td>${new Date(t.date_time).toLocaleDateString()}</td>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<a href="#/friendprofile/${t.winner}">\n\t\t\t\t\t\t\t<img src="${e}" alt="${t.winner}" class ="avatar"> ${t.winner}\n\t\t\t\t\t\t</a>\n\t\t\t\t\t</td>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<a href="#/friendprofile/${t.loser}">\n\t\t\t\t\t\t\t<img src="${n}" alt="${t.loser}" class ="avatar"> ${t.loser}\n\t\t\t\t\t\t</a>\n\t\t\t\t\t</td>\n                    <td class="${i}">${s}</td>\n                    <td>${a}</td>\n                    <td>${t.winner_score} - ${t.loser_score}</td>\n                </tr>\n            `})).join("");let s=document.querySelector("#section");if(s){s.innerHTML=`\n                <div class="main-container2 ga-hidden">\n                    <h1 class="title2">Match History</h1>\n                    <div class="history-container2">\n                        <a class="nav-link" href="#/dashboard" id="game-history-button">\n                            <span class="close-btn2" id="close-btn">&times;</span>\n                        </a>\n                        <table class="history-table2">\n                            <thead>\n                                <tr>\n                                    <th>Date</th>\n                                    <th>Winner</th>\n                                    <th>Loser</th>\n                                    <th>Result</th>\n                                    <th>Game Mode</th>\n                                    <th>Score</th>\n                                </tr>\n                            </thead>\n                            <tbody>\n                                ${a}\n                            </tbody>\n                        </table>\n                    </div>\n                </div>\n            `;const t=document.querySelector(".main-container2");t&&setTimeout((()=>{t.classList.add("ga-visible"),t.classList.remove("ga-hidden")}),100)}}catch(t){console.error("Error fetching game history:",t)}})():t.startsWith("#/publicgamehistory")?(async()=>{const t=window.location.hash.split("/"),e=t[t.length-1];d();try{const t=await T(`${rt}/${e}/game-history/`);if(!t.ok)throw new Error("Failed to fetch game history");const n=await t.json(),o=Array.isArray(n)?n:[],a=n.length>0?n[0].user:"",s=o.map((t=>{const e=t.winner_avatar,n=t.loser_avatar,o=t.local_game?"Locale":"Online",s=t.winner===a?"Victory":"Defeat",i=t.winner===a?"victory":"defeat";return`\n                <tr>\n                    <td>${new Date(t.date_time).toLocaleDateString()}</td>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<a href="#/friendprofile/${t.winner}">\n\t\t\t\t\t\t\t<img src="${e}" alt="${t.winner}" class ="avatar"> ${t.winner}\n\t\t\t\t\t\t</a>\n\t\t\t\t\t</td>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<a href="#/friendprofile/${t.loser}">\n\t\t\t\t\t\t\t<img src="${n}" alt="${t.loser}" class ="avatar"> ${t.loser}\n\t\t\t\t\t\t</a>\n\t\t\t\t\t</td>\n                    <td class="${i}">${s}</td>\n                    <td>${o}</td>\n                    <td>${t.winner_score} - ${t.loser_score}</td>\n                </tr>\n            `})).join("");let i=document.querySelector("#section");if(i){i.innerHTML=`\n                <div class="main-container2 ga-hidden">\n                    <h1 class="title2">Match History</h1>\n                    <div class="history-container2">\n                        <button id="close-btn-pgh" class="close-btn2">\n                            &times;\n                        </button> \n                        <table class="history-table2">\n                            <thead>\n                                <tr>\n                                    <th>Date</th>\n                                    <th>Winner</th>\n                                    <th>Loser</th>\n                                    <th>Result</th>\n                                    <th>Game Mode</th>\n                                    <th>Score</th>\n                                </tr>\n                            </thead>\n                            <tbody>\n                                ${s}\n                            </tbody>\n                        </table>\n                    </div>\n                </div>\n            `;const t=document.querySelector(".main-container2");t&&setTimeout((()=>{t.classList.add("ga-visible"),t.classList.remove("ga-hidden")}),100),document.getElementById("close-btn-pgh").addEventListener("click",(()=>{window.history.back()}))}}catch(t){console.error("Error fetching game history:",t)}})():"#/logout"===t?(async()=>{let t=document.querySelector("#section");d(),t&&(t.innerHTML='   <div class="frame-LogOutMsg-container">\n            <div class="frame-LogOutMsg">\n                <p class="msg-confirmation">Êtes-vous sûr(e) de vouloir vous déconnecter ?</p>\n                <div class="button-logout">\n                    <button type="button" class="btn btn-success" id="logout-yes">Oui</button>\n                    <button type="button" class="btn btn-danger" id="logout-no">Non</button>\n                </div>\n            </div>\n        </div>\n    ',document.getElementById("logout-yes").addEventListener("click",ut),document.getElementById("logout-no").addEventListener("click",(()=>{window.history.back()})))})():"#/chartemsg"===t?(async()=>{if(!await S())throw new Error("User is not authenticated");let t=document.querySelector("#section");d(),t&&(t.innerHTML='   <div class="charte-container">\n            <h2 class="charte-title">Charte de confidentialité</h2>\n            <div class="charte-msg">\n                <p class="charte-text">Bienvenue sur notre site !<br>\n                    Nous respectons votre vie privée et nous engageons à protéger vos données personnelles. Cette charte de confidentialité décrit comment nous collectons, utilisons et protégeons vos informations.<br>\n                    1 - Nous collectons des informations telles que votre adresse e-mail ou votre pseudonyme. Ces informations sont recueillies lors de l\'inscription et de l\'utilisation régulière du site.<br>\n                    2 - Votre adresse mail ou votre mot de passe ne seront jamais communiqués aux autres utilisateurs ou à des organisations tierces, et nous garantissons une politique de sécurité stricte pour protéger vos informations contre tout accès non autorisé. <br>\n                    3 - La page paramètres du compte vous permet d\'accéder à vos données personnelles, de les modifier, ou de nous en demander la suppression immédiate. <br>\n                    N.B. : Les utilisateurs inscrits grâce à leur compte sur l\'intranet de l\'Ecole 42 peuvent uniquement demander la suppression de leurs données, toute modification doit être effectuée directement sur votre espace à l\'adresse suivante: https://profile.intra.42.fr/<br>\n                    Merci de votre confiance\n                </p>\n                <div>\n                    <button type="button" class="btn btn-light btn-charte" id="ok-button">OK</button>\n                </div>\n            </div>\n        </div>\n    ',document.getElementById("ok-button").addEventListener("click",(()=>{window.history.back()})))})():"#/update-username"===t?pt():"#/update-email"===t?vt():"#/update-password"===t?ht():"#/delete-account"===t?ft():t.startsWith("#/qr-code")?(()=>{d();let t=document.querySelector("#section");t.id="qr-section";const e=new URLSearchParams(window.location.hash.split("?")[1]).get("tfa");e?(t.innerHTML='\n        <div class="container-qr-code">\n            <h1 class="title-qr-code">Scanner le QR Code</h1>\n            <div class="qr-code-container">\n                <img id="qr-code" src="" alt="QR Code">\n            </div>\n            <button class="button-qr-code" id="proceed-to-2fa-auth">Continuer</button>\n        </div>\n    ',fetch(`${wt}/generate-2fa-code/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tfa_token:e})}).then((t=>t.ok?t.blob():t.json().then((t=>{throw new Error(t.error||"Erreur lors de la génération du QR Code")})))).then((t=>{const e=URL.createObjectURL(t);document.getElementById("qr-code").src=e})).catch((t=>{console.error("Erreur lors de la génération du QR Code:",t),alert(`Erreur lors de la génération du QR Code: ${t.message}`)})),document.getElementById("proceed-to-2fa-auth").addEventListener("click",(()=>{window.location.href=`#/qr-2fa-auth?tfa=${encodeURIComponent(e)}`}))):(console.error("TFA not found in URL"),alert("TFA non trouvé. Veuillez réessayer."))})():t.startsWith("#/2fa-auth")?(async()=>{let t=document.querySelector("#section");if(!t)return void console.error("#section not found in the DOM");let e=document.querySelector(".navbar-container");e&&e.remove();let n=document.querySelector(".logout-container");n&&n.remove();const o=new URLSearchParams(window.location.hash.split("?")[1]).get("tfa");if(!o)return console.error("TFA not found in URL"),void alert("TFA non trouvé. Veuillez réessayer.");t.innerHTML='\n      <div class="container-2FA">\n          <div class="login-form-2FA">\n              <h1 class="title-2FA">ENTREZ LE CODE REÇU PAR MAIL</h1>\n              <input type="text" id="two-fa-code" class="input-2fa" placeholder="Tapez le code ici">\n              <button id="verify-2fa-code" class="button-2FA">Confirmer</button>\n              <button id="resend-2fa-code" class="button-2FA">Renvoyer</button>\n          </div>\n      </div>\n      ';const a=document.getElementById("verify-2fa-code"),s=document.getElementById("resend-2fa-code");a.addEventListener("click",(async()=>{const t=document.getElementById("two-fa-code").value;if(t)try{const e=await fetch(`${lt}/validate-2fa-code/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tfa_token:o,code:t})});if(!e.ok){const t=await e.json();throw new Error(t.error||"Erreur de validation du code 2FA.")}const n=await e.json();if(console.log("2FA code validated:",n),!n.access||!n.refresh)throw new Error("Tokens non valides reçus");localStorage.removeItem("tfa"),localStorage.setItem("accessToken",n.access),localStorage.setItem("refreshToken",n.refresh),window.location.href="#/dashboard"}catch(t){console.error("Erreur de validation du code 2FA:",t),alert(t.message)}else alert("Veuillez entrer le code 2FA.")})),s.addEventListener("click",(async()=>{try{const t=await fetch(`${lt}/generate-2fa-code/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tfa_token:o})});if(!t.ok){const e=await t.json();throw new Error(e.error||"Erreur de réenvoi du code 2FA.")}alert("Le code 2FA a été renvoyé.")}catch(t){console.error("Erreur de réenvoi du code 2FA:",t),alert(t.message)}}))})():t.startsWith("#/qr-2fa-auth")?(async()=>{let t=document.querySelector("#section");if(!t)return void console.error("#section not found in the DOM");let e=document.querySelector(".navbar-container");e&&e.remove();let n=document.querySelector(".logout-container");n&&n.remove();const o=new URLSearchParams(window.location.hash.split("?")[1]).get("tfa");if(!o)return console.error("TFA not found in URL"),void alert("TFA non trouvé. Veuillez réessayer.");t.innerHTML='\n      <div class="container-2FA">\n          <div class="login-form-2FA">\n              <h1 class="title-2FA">ENTREZ LE CODE REÇU SUR L\'APPLICATION</h1>\n              <input type="text" id="two-fa-code" class="input-2fa" placeholder="Tapez le code ici">\n              <button id="verify-2fa-code" class="button-2FA">Confirmer</button>\n              <button id="back-to-qr-code" class="button-2FA">Retourner au QR Code</button>\n          </div>\n      </div>\n      ';const a=document.getElementById("verify-2fa-code"),s=document.getElementById("back-to-qr-code");a.addEventListener("click",(async()=>{const t=document.getElementById("two-fa-code").value;if(t)try{const e=await fetch(`${ct}/validate-2fa-code/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tfa_token:o,code:t})});if(!e.ok){const t=await e.json();throw new Error(t.error||"Erreur de validation du code 2FA.")}const n=await e.json();if(console.log("2FA code validated:",n),!n.access||!n.refresh)throw new Error("Tokens non valides reçus");localStorage.removeItem("tfa"),localStorage.setItem("accessToken",n.access),localStorage.setItem("refreshToken",n.refresh),window.location.href="#/dashboard"}catch(t){console.error("Erreur de validation du code 2FA:",t),alert(t.message)}else alert("Veuillez entrer le code 2FA.")})),s.addEventListener("click",(()=>{window.location.href=`#/qr-code?tfa=${o}`}))})():t.startsWith("#/friendprofile/")?(async()=>{if(!await S())throw new Error("User is not authenticated");let t=document.querySelector("#section");t.innerHTML="",t.append(nt())})():e.innerHTML="<h1>Page not found</h1>",window.isInternalNavigation=!1},$t=()=>{console.log("Updating active link");document.querySelectorAll(".nav-link").forEach((t=>{t.classList.remove("active")}));const t=location.hash,e=document.querySelector(`.nav-link[href="${t}"]`);e&&(e.classList.add("active"),console.log("Active link:",e))},Lt=async()=>{let t=document.getElementById("root");if(!t)return void console.error("#root not found in the DOM");t.innerHTML="";const e=document.createElement("div");e.classList.add("navbar-supperposition"),e.append((()=>{let t=document.createElement("nav");return t.classList.add("navbar-container"),t.innerHTML='\n      <nav class="navbar-container">\n        <div class="container-fluid">\n          <div class="myNavbar d-none d-lg-flex">\n            <a class="nav-link" href="#/game"><i class="bi bi-controller" style="font-size: 4rem; color: white;"></i></a>\n            <a class="nav-link" href="#/dashboard"><i class="bi bi-person-fill" style="font-size: 4rem; color: white;"></i></a>\n            <a class="nav-link" href="#/settings"><i class="bi bi-gear-fill" style="font-size: 4rem; color: white;"></i></a>\n            <a class="nav-link" href="#/aboutus"><i class="bi bi-info-circle" style="font-size: 4rem; color: white;"></i></a>\n          </div>\n        </div>\n      </nav>\n\n    <nav class="navbar-container-media">\n         <div class="myNavbar-sm d-none d-lg-flex">\n          <div class="navbar">\n            <div class="container-fluid">\n              <a class="navbar-brand" href="#"></a>\n                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarTogglerDemo02"\n                  aria-controls="navbarTogglerDemo02" aria-expanded="false" aria-label="Toggle navigation">\n                  <span class="navbar-toggler-icon"></span>\n                </button>\n              <div class="collapse navbar-collapse" id="navbarTogglerDemo02">\n                <ul class="navbar-nav">\n                  <li class="nav-item">\n                    <a class="nav-link" active href="#/game">Jeu</a>\n                  </li>\n                  <li class="nav-item">\n                    <a class="nav-link" aria-current="page" href="#/dashboard">Mon profil</a>\n                  </li>\n                  <li class="nav-item">\n                    <a class="nav-link" aria-current="page" href="#/settings">Paramètres</a>\n                  </li>\n                  <li class="nav-item">\n                    <a class="nav-link" aria-current="page" href="#/aboutus">À propos de nous</a>\n                  </li>\n                     <li class="nav-item">\n                    <a class="nav-link" aria-current="page" href="#/logout">Déconnexion</a>\n                  </li>\n                </ul>\n              </div>\n            </div>\n          </div>\n        </div>\n      </nav>\n\n\n      <nav class="navbar-container-sm">\n         <div class="myNavbar-sm d-flex d-lg-none navSm">\n          <div class="navbar">\n            <div class="container-fluid">\n              <a class="navbar-brand" href="#"></a>\n                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarTogglerDemo02"\n                  aria-controls="navbarTogglerDemo02" aria-expanded="false" aria-label="Toggle navigation">\n                  <span class="navbar-toggler-icon"></span>\n                </button>\n              <div class="collapse navbar-collapse" id="navbarTogglerDemo02">\n                <ul class="navbar-nav">\n                  <li class="nav-item">\n                    <a class="nav-link" active href="#/game">Jeu</a>\n                  </li>\n                  <li class="nav-item">\n                    <a class="nav-link" aria-current="page" href="#/dashboard">Mon profil</a>\n                  </li>\n                  <li class="nav-item">\n                    <a class="nav-link" aria-current="page" href="#/settings">Paramètres</a>\n                  </li>\n                  <li class="nav-item">\n                    <a class="nav-link" aria-current="page" href="#/aboutus">À propos de nous</a>\n                  </li>\n                     <li class="nav-item">\n                    <a class="nav-link" aria-current="page" href="#/logout">Déconnexion</a>\n                  </li>\n                </ul>\n              </div>\n            </div>\n          </div>\n        </div>\n      </nav>\n\n  ',t})()),e.append((()=>{let t=document.createElement("div");return t.classList.add("logout-container"),t.innerHTML=' \n        <a class="nav-link d-none d-lg-flex" href="#/logout">\n            <i class="bi bi-box-arrow-right"></i>\n        </a>\n    ',t})()),t.append(e),t.append((()=>{let t=document.createElement("main");return t.id="section",t})()),window.location.hash||(window.location.hash="#/"),await kt(),setTimeout($t,100)};window.isInternalNavigation=!1,document.addEventListener("DOMContentLoaded",(function(){localStorage.getItem("backgroundClass")?P():document.body.classList.add("bg-nagoya"),window.isInternalNavigation=!1,Lt()})),window.addEventListener("hashchange",Lt)}},n={};function o(t){var a=n[t];if(void 0!==a)return a.exports;var s=n[t]={exports:{}};return e[t](s,s.exports,o),s.exports}o.m=e,t=[],o.O=(e,n,a,s)=>{if(!n){var i=1/0;for(d=0;d<t.length;d++){for(var[n,a,s]=t[d],r=!0,l=0;l<n.length;l++)(!1&s||i>=s)&&Object.keys(o.O).every((t=>o.O[t](n[l])))?n.splice(l--,1):(r=!1,s<i&&(i=s));if(r){t.splice(d--,1);var c=a();void 0!==c&&(e=c)}}return e}s=s||0;for(var d=t.length;d>0&&t[d-1][2]>s;d--)t[d]=t[d-1];t[d]=[n,a,s]},o.d=(t,e)=>{for(var n in e)o.o(e,n)&&!o.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},o.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),o.p="/",(()=>{var t={792:0};o.O.j=e=>0===t[e];var e=(e,n)=>{var a,s,[i,r,l]=n,c=0;if(i.some((e=>0!==t[e]))){for(a in r)o.o(r,a)&&(o.m[a]=r[a]);if(l)var d=l(o)}for(e&&e(n);c<i.length;c++)s=i[c],o.o(t,s)&&t[s]&&t[s][0](),t[s]=0;return o.O(d)},n=self.webpackChunkasset=self.webpackChunkasset||[];n.forEach(e.bind(null,0)),n.push=e.bind(null,n.push.bind(n))})();var a=o.O(void 0,[964],(()=>o(354)));a=o.O(a)})();